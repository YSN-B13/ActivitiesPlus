<!DOCTYPE html>
<html>
<head>
    <title>Recherche Avancée</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="container mt-5">

<h2>Générateur de Requêtes Avancées</h2>

{% if error %}
<div class="alert alert-danger">{{ error }}</div>
{% endif %}

<form method="POST" action="/admin/advanced_search" class="mb-4 border p-4 rounded shadow-sm">
    <div class="row">
        <div class="col-md-4">
            <h4>Entité A</h4>
            <select name="entity1" class="form-select mb-2">
                {% for e in entities %}
                <option value="{{ e }}" {% if search_metadata and search_metadata.e1 == e %}selected{% endif %}>{{ e|upper }}</option>
                {% endfor %}
            </select>
            <input type="text" name="e1_Nom" class="form-control mb-1" placeholder="Filtre: Nom (opt)">
            <input type="text" name="e1_Filiere" class="form-control mb-1" placeholder="Filtre: Filiere (opt)">
        </div>

        <div class="col-md-4 text-center">
            <h4>Relation</h4>
            <select name="operation" class="form-select mt-4">
                <option value="intersection">INTERSECTION (ET)</option>
                <option value="union">UNION (OU)</option>
                <option value="difference">DIFFÉRENCE (SAUF)</option>
                <option value="related">LIÉ À (JOINTURE)</option>
            </select>
            <div class="form-text text-muted">
                Utilisez Union/Inter/Diff seulement si Entité A = Entité B.
                Utilisez "Lié à" pour connecter deux types différents (ex: Club lié à Sponsor).
            </div>
        </div>

        <div class="col-md-4">
            <h4>Entité B</h4>
            <select name="entity2" class="form-select mb-2">
                {% for e in entities %}
                <option value="{{ e }}" {% if search_metadata and search_metadata.e2 == e %}selected{% endif %}>{{ e|upper }}</option>
                {% endfor %}
            </select>
            <input type="text" name="e2_Nom" class="form-control mb-1" placeholder="Filtre: Nom/Titre (opt)">
            <input type="text" name="e2_Filiere" class="form-control mb-1" placeholder="Filtre: Filiere (opt)">
        </div>
    </div>
    
    <div class="text-center mt-3">
        <button type="submit" class="btn btn-primary btn-lg">Lancer la Recherche</button>
    </div>
</form>

{% if results %}
<h3>Résultats ({{ results|length }})</h3>
<table class="table table-striped">
    <thead>
        <tr>
            {% for h in headers %}
            <th>{{ h }}</th>
            {% endfor %}
        </tr>
    </thead>
    <tbody>
        {% for row in results %}
        <tr>
            {% for h in headers %}
            <td>{{ row[h] }}</td>
            {% endfor %}
        </tr>
        {% endfor %}
    </tbody>
</table>
{% endif %}

</body>
</html>